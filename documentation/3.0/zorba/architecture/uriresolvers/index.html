<!DOCTYPE html><html lang="en" class="js cssanimations ng-scope" ng-app="28.ioApp" prefix="og: http://ogp.me/ns#" ng-controller="MainCtrl"><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Zorba - The NoSQL Query Processor</title>
        <meta name="description" content="Zorba - The NoSQL Query Processor">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">

        <meta content="28.io" name="apple-mobile-web-app-title">
        <link href="/images/iphone-icon.png" rel="apple-touch-icon-precomposed">
        <link href="/favicon.png" rel="icon" type="image/png">

        <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="http://www.zorba.io/blog/atom.xml">
        <base href="/">
        <link rel="stylesheet" href="/styles/index.css">
    <style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak{display:none;}ng\:form{display:block;}</style></head>
    <body ready="" class="" ng-cloak="undefined">
        <!--[if lt IE 9]>
            <script type="text/javascript">location.href = "/outdated";</script>
        <![endif]-->
        <div class="navbar navbar-default navbar-fixed-top" id="top-menu" navbar-toggle="">
            <div class="container">
                <a href="/home" id="logo">
<svg width="172px" height="44px" viewBox="0 0 172 44" version="1.1" xmlns="http://www.w3.org/2000/svg" style="margin-right: 30px">
    <defs></defs>
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="g3354-1-3-0" transform="translate(70.000000, 3.000000)" fill="#3498DB">
            <path d="M36.8599281,6.08695652 C23.7462235,7.46138534 17.3241713,7.87186266 12.0855118,12.5394913 C9.61392853,8.89602738 2.41221529,6.6246591 0,6.89251341 L0.0401259499,9.84221332 C11.3218642,17.172198 8.15927521,31.2798979 5.60530924,40 L18.0693794,40 C15.1069036,30.4981162 15.7891093,23.8890354 16.4644797,20.4999181 C17.5216924,12.0444371 30.0443188,9.56353073 37,7.95199463 L36.8599281,6.08695652 Z" id="path3217-2-16-8-3-4-8-9"></path>
            <path d="M17.2092989,4.7826087 C17.2112417,6.18001565 16.3916489,7.47202866 15.0597079,8.1712421 C13.7277668,8.87045553 12.0861867,8.87045553 10.7542456,8.1712421 C9.42230457,7.47202866 8.60271176,6.18001565 8.60465461,4.7826087 C8.60271176,3.38520174 9.42230457,2.09318873 10.7542456,1.39397529 C12.0861867,0.694761858 13.7277668,0.694761858 15.0597079,1.39397529 C16.3916489,2.09318873 17.2112417,3.38520174 17.2092989,4.7826087 L17.2092989,4.7826087 Z" id="path3830-2-4-8-2-3-6-0-4" transform="translate(12.906977, 4.782609) rotate(-12.486691) translate(-12.906977, -4.782609) "></path>
        </g>
        <path d="M0.896,35.2271939 L0.896,42.1301694 L34.4088328,42.1301694 L34.4088328,34.7818406 L12.5308539,34.7818406 L33.8521412,9.28536648 L33.8521412,2.38239095 L2.56607473,2.38239095 L2.56607473,9.73071974 L22.2172873,9.73071974 L0.896,35.2271939 Z M37.8046514,27.7675268 C37.8046514,30.0685301 38.1572192,32.1468246 38.8623654,34.0024724 C39.5675116,35.8581203 40.5695464,37.4446754 41.8684999,38.7621854 C43.1674534,40.0796954 44.7261743,41.0910083 46.5447092,41.7961545 C48.3632441,42.5013007 50.4044261,42.8538685 52.6683165,42.8538685 C54.9322069,42.8538685 56.982667,42.5013007 58.8197584,41.7961545 C60.6568498,41.0910083 62.2248487,40.0796954 63.5238022,38.7621854 C64.8227557,37.4446754 65.8247905,35.8581203 66.5299367,34.0024724 C67.2350829,32.1468246 67.5876507,30.0685301 67.5876507,27.7675268 C67.5876507,25.4665234 67.2350829,23.3789509 66.5299367,21.5047466 C65.8247905,19.6305422 64.8227557,18.034709 63.5238022,16.717199 C62.2248487,15.399689 60.6568498,14.379098 58.8197584,13.6553953 C56.982667,12.9316927 54.9322069,12.5698468 52.6683165,12.5698468 C50.4044261,12.5698468 48.3632441,12.9316927 46.5447092,13.6553953 C44.7261743,14.379098 43.1674534,15.399689 41.8684999,16.717199 C40.5695464,18.034709 39.5675116,19.6305422 38.8623654,21.5047466 C38.1572192,23.3789509 37.8046514,25.4665234 37.8046514,27.7675268 Z M45.7096718,27.7675268 C45.7096718,26.6170251 45.821009,25.4850969 46.0436867,24.3717082 C46.2663645,23.2583195 46.6467666,22.2748408 47.1849045,21.4212428 C47.7230424,20.5676448 48.4374561,19.8717873 49.328167,19.3336494 C50.218878,18.7955115 51.33225,18.5264466 52.6683165,18.5264466 C54.0043829,18.5264466 55.1270331,18.7955115 56.0363005,19.3336494 C56.945568,19.8717873 57.6692598,20.5676448 58.2073977,21.4212428 C58.7455355,22.2748408 59.1259376,23.2583195 59.3486154,24.3717082 C59.5712931,25.4850969 59.6826303,26.6170251 59.6826303,27.7675268 C59.6826303,28.9180285 59.5712931,30.0406786 59.3486154,31.1355108 C59.1259376,32.230343 58.7455355,33.2138217 58.2073977,34.0859762 C57.6692598,34.9581306 56.945568,35.6539882 56.0363005,36.1735696 C55.1270331,36.693151 54.0043829,36.9529378 52.6683165,36.9529378 C51.33225,36.9529378 50.218878,36.693151 49.328167,36.1735696 C48.4374561,35.6539882 47.7230424,34.9581306 47.1849045,34.0859762 C46.6467666,33.2138217 46.2663645,32.230343 46.0436867,31.1355108 C45.821009,30.0406786 45.7096718,28.9180285 45.7096718,27.7675268 Z" id="Zo" fill="#333333"></path>
        <path d="M109.28037,2.38239095 L109.28037,42.1301694 L116.795707,42.1301694 L116.795707,38.456005 L116.907045,38.456005 C117.760643,40.0518622 119.022465,41.1837904 120.692548,41.8518236 C122.362631,42.5198569 124.255363,42.8538685 126.370802,42.8538685 C127.818207,42.8538685 129.247034,42.5569693 130.657327,41.9631619 C132.067619,41.3693546 133.338719,40.4601008 134.470664,39.2353732 C135.602609,38.0106456 136.521141,36.4426467 137.226287,34.5313294 C137.931434,32.6200121 138.284001,30.3468776 138.284001,27.7118576 C138.284001,25.0768377 137.931434,22.8037031 137.226287,20.8923858 C136.521141,18.9810685 135.602609,17.4130696 134.470664,16.188342 C133.338719,14.9636144 132.067619,14.0543606 130.657327,13.4605533 C129.247034,12.866746 127.818207,12.5698468 126.370802,12.5698468 C124.58938,12.5698468 122.872931,12.9131365 121.221405,13.5997262 C119.569878,14.2863159 118.261666,15.3718536 117.296729,16.8563719 L117.185391,16.8563719 L117.185391,2.38239095 L109.28037,2.38239095 Z M130.378981,27.7675268 C130.378981,28.9551414 130.249088,30.1056258 129.989297,31.2190145 C129.729506,32.3324033 129.32127,33.3158819 128.764575,34.1694799 C128.207881,35.0230779 127.512024,35.7003792 126.676982,36.2014041 C125.841941,36.7024291 124.830628,36.9529378 123.643013,36.9529378 C122.492511,36.9529378 121.490477,36.7024291 120.636878,36.2014041 C119.78328,35.7003792 119.078145,35.0230779 118.521451,34.1694799 C117.964756,33.3158819 117.55652,32.3324033 117.296729,31.2190145 C117.036938,30.1056258 116.907045,28.9551414 116.907045,27.7675268 C116.907045,26.5427992 117.036938,25.3737586 117.296729,24.2603699 C117.55652,23.1469811 117.964756,22.1635025 118.521451,21.3099045 C119.078145,20.4563065 119.78328,19.7790052 120.636878,19.2779803 C121.490477,18.7769553 122.492511,18.5264466 123.643013,18.5264466 C124.830628,18.5264466 125.841941,18.7769553 126.676982,19.2779803 C127.512024,19.7790052 128.207881,20.4563065 128.764575,21.3099045 C129.32127,22.1635025 129.729506,23.1469811 129.989297,24.2603699 C130.249088,25.3737586 130.378981,26.5427992 130.378981,27.7675268 Z M142.960211,22.200611 L150.865231,22.200611 C151.013683,20.6418668 151.533256,19.5284948 152.423967,18.8604616 C153.314678,18.1924283 154.539388,17.8584167 156.098132,17.8584167 C156.803278,17.8584167 157.462023,17.9048072 158.074387,17.9975896 C158.686751,18.090372 159.224881,18.275934 159.688792,18.5542812 C160.152704,18.8326284 160.523828,19.2223086 160.802176,19.7233335 C161.080523,20.2243584 161.219694,20.9016597 161.219694,21.7552578 C161.256807,22.5717428 161.015577,23.1933755 160.495995,23.6201745 C159.976414,24.0469735 159.271278,24.3717071 158.380567,24.5943848 C157.489856,24.8170625 156.469265,24.9840683 155.318764,25.0954072 C154.168262,25.2067461 152.999221,25.3551957 151.811607,25.5407605 C150.623992,25.7263253 149.445673,25.976834 148.276615,26.2922941 C147.107557,26.6077542 146.06841,27.0809373 145.159142,27.7118576 C144.249875,28.3427779 143.507627,29.187085 142.932376,30.2448043 C142.357125,31.3025236 142.069504,32.6478481 142.069504,34.2808182 C142.069504,35.7653365 142.320013,37.0457143 142.821038,38.1219901 C143.322063,39.1982658 144.01792,40.0889634 144.908631,40.7941096 C145.799342,41.4992558 146.838489,42.0188294 148.026104,42.352846 C149.213719,42.6868627 150.494096,42.8538685 151.867276,42.8538685 C153.648698,42.8538685 155.392981,42.5940817 157.100177,42.0745003 C158.807373,41.5549189 160.291869,40.645665 161.553709,39.3467115 C161.590822,39.82918 161.655769,40.3023631 161.748551,40.7662751 C161.841334,41.230187 161.961949,41.6848139 162.110401,42.1301694 L170.12676,42.1301694 C169.75563,41.5363621 169.495843,40.6456645 169.347391,39.4580499 C169.198939,38.2704352 169.124715,37.0271698 169.124715,35.7282163 L169.124715,20.7532129 C169.124715,19.0089039 168.735034,17.6079108 167.955662,16.5501915 C167.17629,15.4924723 166.174255,14.6667213 164.949528,14.072914 C163.7248,13.4791067 162.370198,13.0801484 160.885679,12.8760271 C159.401161,12.6719059 157.935221,12.5698468 156.487816,12.5698468 C154.891959,12.5698468 153.305404,12.7275745 151.728103,13.0430346 C150.150802,13.3584948 148.731253,13.8873465 147.469412,14.6296056 C146.207572,15.3718647 145.168425,16.3553434 144.35194,17.580071 C143.535455,18.8047985 143.07155,20.3449632 142.960211,22.200611 Z M161.219694,28.0458726 L161.219694,30.9963379 C161.219694,31.4416934 161.173304,32.0354918 161.080521,32.777751 C160.987739,33.5200101 160.73723,34.25298 160.328988,34.9766827 C159.920745,35.7003853 159.289834,36.322018 158.436236,36.8415995 C157.582638,37.3611809 156.376485,37.6209677 154.817741,37.6209677 C154.186821,37.6209677 153.574466,37.5652991 152.980659,37.4539602 C152.386852,37.3426213 151.867278,37.1477812 151.421923,36.869434 C150.976567,36.5910868 150.623999,36.2106847 150.364209,35.7282163 C150.104418,35.2457479 149.974524,34.6519494 149.974524,33.9468033 C149.974524,33.2045441 150.104418,32.5921895 150.364209,32.1097211 C150.623999,31.6272526 150.967289,31.2282943 151.394088,30.9128342 C151.820887,30.597374 152.321904,30.3468653 152.897155,30.1613005 C153.472406,29.9757358 154.056926,29.8272862 154.650734,29.7159473 C155.281654,29.6046084 155.912565,29.5118274 156.543485,29.4376015 C157.174405,29.3633756 157.777482,29.2705946 158.352733,29.1592557 C158.927984,29.0479168 159.466113,28.9087453 159.967138,28.741737 C160.468163,28.5747287 160.885678,28.3427762 161.219694,28.0458726 Z" id="ba" fill="#333333"></path>
    </g>
</svg>
                </a>
                <div class="navbar-header">
                    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li ng-class="navClass(menu.home.href)">
                            <a ng-href="/home" ng-bind="menu.home.label" class="ng-binding" href="/home">Home</a>
                        </li>
                        <li ng-class="navClass(menu.documentation.href)" class="active">
                            <a ng-href="/documentation" ng-bind="menu.documentation.label" class="ng-binding" href="/documentation">Documentation</a>
                        </li>
                        <li ng-class="navClass(menu.tryzorba.href)">
                            <a ng-href="http://try.zorba.io/" ng-bind="menu.tryzorba.label" class="ng-binding" href="http://try.zorba.io/">Live Demo</a>
                        </li>
                        <li ng-class="navClass(menu.blog.href)">
                            <a ng-href="/blog" ng-bind="menu.blog.label" class="ng-binding" href="/blog">Blog</a>
                        </li>
                        <li ng-class="navClass(menu.download.href)">
                            <a ng-href="/download" ng-bind="menu.download.label" class="ng-binding" href="/download">Download</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="ng-view"><div class="container ng-scope" id="documentation">
    <div class="row">
        <!-- ngIf: state !== 'notfound' && !debug --><div class="col-sm-4 sidebar ng-scope" ng-if="state !== 'notfound' &amp;&amp; !debug">
            <div class="inner-sidebar">
            <ul class="nav nav-pills nav-stacked">
                <li class="dropdown selected-version">
                    <a class="dropdown-toggle">
                        <span ng-bind="currentVersion.version" class="ng-binding">3.0</span>
                        <span ng-bind="currentVersion.codename" class="ng-binding">Kratos</span>
                        <span ng-show="currentVersion.latest">(latest)</span>
                        <!--i class="fa fa-caret-down"></i-->
                    </a>
                    <!--ul class="dropdown-menu versions">
                        <li ng-repeat="version in index.versions" ng-show="currentVersion.version != version.version">
                            <a ng-href="/documentation/{{version.version}}">
                                <span ng-bind="version.version"></span>
                                <span ng-bind="version.codename"></span>
                                <span ng-show="version.latest">(latest)</span>
                            </a>
                        </li>
                    </ul-->
                    <ul class="versions">
                        <!-- ngRepeat: version in index.versions --><li ng-repeat="version in index.versions" ng-show="currentVersion.version != version.version" class="ng-scope" style="display: none; ">
                            <a ng-href="/documentation/3.0" href="/documentation/3.0">
                                <span ng-bind="version.version" class="ng-binding">3.0</span>
                                <span ng-bind="version.codename" class="ng-binding">Kratos</span>
                                <span ng-show="version.latest">(latest)</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
            <div class="slider">
                <!-- Current -->
                <div class="current" ng-show="panel.status === 'current'">
                    <ul class="nav nav-pills nav-stacked">
                        <li ng-show="path.split('/').length &gt; 3">
                            <a href="/documentation/3.0/zorba" ng-click="previous()">
                                <i class="fa fa-angle-left"></i>
                                <span>Previous</span>
                            </a>
                        </li>
                        <!-- ngRepeat: item in currentItem.children --><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/data_lifecycle" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/data_lifecycle">
                                <span ng-bind="item.label" class="ng-binding">Data Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/schema_lifecycle" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/schema_lifecycle">
                                <span ng-bind="item.label" class="ng-binding">Schema Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope active">
                            <a ng-href="/documentation/3.0/zorba/architecture/uriresolvers" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/uriresolvers">
                                <span ng-bind="item.label" class="ng-binding">URI Resolvers</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/data_converters" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/data_converters">
                                <span ng-bind="item.label" class="ng-binding">Data Converters</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/ft" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/ft">
                                <span ng-bind="item.label" class="ng-binding">Full Text</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/errors_warnings" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/errors_warnings">
                                <span ng-bind="item.label" class="ng-binding">Errors and Warnings</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/dependencies" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/dependencies">
                                <span ng-bind="item.label" class="ng-binding">Dependencies</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/memory_management" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/memory_management">
                                <span ng-bind="item.label" class="ng-binding">Memory Management</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" ng-class="{ active: (path + '/' + item.id) === currentPath}" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/memory_leaks" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/memory_leaks">
                                <span ng-bind="item.label" class="ng-binding">Memory Leaks</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Next -->
                <div class="next slideRight" ng-show="panel.status === 'next'" next="" style="display: none; ">
                    <ul class="nav nav-pills nav-stacked">
                        <li ng-show="menu &amp;&amp; path.split('/').length &gt; 4">
                            <a ng-href="/documentation/3.0" ng-click="previous()" href="/documentation/3.0">
                                <i class="fa fa-angle-left"></i>
                                <span>Previous</span>
                            </a>
                        </li>
                        <!-- ngRepeat: item in currentItem.parent.children --><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">XQuery &amp; JSONiq</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Build Instructions</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Install</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Command Line Utility</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">General Architecture</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Library Modules</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Scripting</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.parent.children" class="ng-scope">
                            <a>
                                <span ng-bind="item.label" class="ng-binding">Specifications</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav nav-pills nav-stacked">
                        <li>
                            <a href="/documentation/3.0/zorba" ng-click="previous()">
                                <i class="fa fa-angle-left"></i>
                                <span>Previous</span>
                            </a>
                        </li>
                        <!-- ngRepeat: item in currentItem.children --><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/data_lifecycle" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/data_lifecycle">
                                <span ng-bind="item.label" class="ng-binding">Data Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/schema_lifecycle" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/schema_lifecycle">
                                <span ng-bind="item.label" class="ng-binding">Schema Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/uriresolvers" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/uriresolvers">
                                <span ng-bind="item.label" class="ng-binding">URI Resolvers</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/data_converters" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/data_converters">
                                <span ng-bind="item.label" class="ng-binding">Data Converters</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/ft" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/ft">
                                <span ng-bind="item.label" class="ng-binding">Full Text</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/errors_warnings" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/errors_warnings">
                                <span ng-bind="item.label" class="ng-binding">Errors and Warnings</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/dependencies" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/dependencies">
                                <span ng-bind="item.label" class="ng-binding">Dependencies</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/memory_management" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/memory_management">
                                <span ng-bind="item.label" class="ng-binding">Memory Management</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a ng-href="/documentation/3.0/zorba/architecture/memory_leaks" ng-click="next(item)" href="/documentation/3.0/zorba/architecture/memory_leaks">
                                <span ng-bind="item.label" class="ng-binding">Memory Leaks</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Previous -->
                <div class="previous slideLeft" ng-show="panel.status === 'previous'" previous="" style="display: none; ">
                    <ul class="nav nav-pills nav-stacked">
                        <li ng-show="menu &amp;&amp; path.split('/').length &gt; 3">
                            <a ng-href="/documentation/3.0/zorba" ng-click="previous()" href="/documentation/3.0/zorba">
                                <i class="fa fa-angle-left"></i>
                                <span>Previous</span>
                            </a>
                        </li>
                        <!-- ngRepeat: item in currentItem.children --><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/data_lifecycle" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Data Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/schema_lifecycle" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Schema Lifecycle</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/uriresolvers" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">URI Resolvers</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/data_converters" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Data Converters</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/ft" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Full Text</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children"></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/errors_warnings" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Errors and Warnings</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/dependencies" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Dependencies</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/memory_management" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Memory Management</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li><li ng-repeat="item in currentItem.children" class="ng-scope">
                            <a href="/documentation/3.0/zorba/architecture/memory_leaks" ng-click="next(item)">
                                <span ng-bind="item.label" class="ng-binding">Memory Leaks</span>
                                <i class="pull-right fa fa-angle-right" ng-show="item.children" style="display: none; "></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav nav-pills nav-stacked">
                        <li>
                            <a href="/documentation/3.0" ng-click="previous()">
                                <i class="fa fa-angle-left"></i>
                                <span>Previous</span>
                            </a>
                        </li>
                        <!-- ngRepeat: item in panel.previous.children -->
                    </ul>
                </div>
            </div>
            </div>
        </div>
        <div class="content col-sm-8" ng-switch="" on="state" ng-class="{ 'col-sm-8': state !== 'notfound', 'col-sm-12': state === 'notfound' }">
            
                <ol class="breadcrumb">
                    <li>
                        <a ng-href="/documentation/latest" class="ng-binding" href="/documentation/latest">
                            Zorba 3.0 Documentation
                        </a>
                    </li>
                    <!-- ngRepeat: crumb in getBreadCrumbs() --><li ng-repeat="crumb in getBreadCrumbs()" ng-class="{ active: $last }" class="ng-scope">
                        <a ng-href="/documentation/latest/zorba" href="/documentation/latest/zorba">
                            <span ng-bind="crumb.label" class="ng-binding">End-User Docs</span>
                        </a>
                    </li><li ng-repeat="crumb in getBreadCrumbs()" ng-class="{ active: $last }" class="ng-scope">
                        <a ng-href="/documentation/latest/zorba/architecture" href="/documentation/latest/zorba/architecture">
                            <span ng-bind="crumb.label" class="ng-binding">General Architecture</span>
                        </a>
                    </li><li ng-repeat="crumb in getBreadCrumbs()" ng-class="{ active: $last }" class="ng-scope active">
                        <a ng-href="/documentation/latest/zorba/architecture/uriresolvers" href="/documentation/latest/zorba/architecture/uriresolvers">
                            <span ng-bind="crumb.label" class="ng-binding">URI Resolvers</span>
                        </a>
                    </li>
                </ol>
            
            <!-- ngSwitchWhen: loading -->
            <!-- ngSwitchWhen: zorba --><div ng-switch-when="zorba" class="ng-scope">
                <p>View as <a ng-href="http://bazaar.launchpad.net/~zorba-coders/zorba/trunk/view/head:/doc/zorba/uriresolvers.dox" target="_blank" href="http://bazaar.launchpad.net/~zorba-coders/zorba/trunk/view/head:/doc/zorba/uriresolvers.dox">source file</a> or <a ng-href="/documentation/3.0-Kratos/zorba/xml/uriresolvers.xml" target="_blank" href="/documentation/3.0-Kratos/zorba/xml/uriresolvers.xml">XML</a>.</p>
                <div ng-bind-html-unsafe="content" class="ng-binding"><div class="doxygen">
  <div><h1 class="title">URI Resolvers</h1>
<div id="motivation" class="sect1"><h2>Motivation</h2>
In JSONiq or XQuery, many resources are named by URIs - most notably schemas and modules, but also documents, full-text stopwords lists and thesauri, and so on. URIs are by convention often given with the <tt>http:</tt> scheme and the domain name of the provider. However, in general it is not desirable to load the resource via HTTP, and in many cases the resource is not actually available at the named URI - in other words, they are <b>URIs</b> (Uniform Resource <b>Identifiers</b>), not <b>URLs</b> (Uniform Resource <b>Locators</b>).Zorba provides a built-in mechanism for mapping URIs to a local filesystem path. It can also load resources via HTTP in situations where that is in fact appropriate. These built-in mechanisms will solve a large number of resource-loading problems. However, it also offers a highly flexible API for extending the built-in mechanisms, which will allow you to resolve URIs from queries in almost any way imaginable to handle application-specific problems.</div>
<div id="builtin_uri_resolver" class="sect1"><h2>Zorba's Built-in URI Resolver</h2>
JSONiq or XQuery itself offer an approach to locating resources via the "at" clause in <tt>import module</tt> and <tt>import schema</tt> statements. However, we recommend that you do not use this approach for most robust applications.For example, the following code snippet imports a library module with target namespace "http://www.example.com/modules/utils".<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>(:<span>&nbsp;</span>Evil<span>&nbsp;</span></span><span class="keyword">import</span><span class="normal"><span>&nbsp;</span>statement<span>&nbsp;</span>:)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">import</span><span class="normal"><span>&nbsp;</span>module<span>&nbsp;</span></span><span class="keyword">namespace</span><span class="normal"><span>&nbsp;</span>utils<span>&nbsp;</span>=<span>&nbsp;</span></span><span class="stringliteral">"http://www.example.com/modules/utils"</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>at<span>&nbsp;</span></span><span class="stringliteral">"/home/foo/xquery/utils.xq"</span><span class="normal">;</span>
</span></pre>In this import statement, the user specifies that the file containing the module is physically located at "/home/foo/xquery/utils.xq".Having the physical location hard-coded isn't desirable for two reasons: First, the physical location of a module or schema may change during the development process; also, frequently the module will be located in a different directory after the application has been deployed. Second, the user may want to package and distribute the application without having other developers to perform code changes in order to have location hints which are valid on their system.Out of the box, Zorba will attempt to map URIs to local filesystem locations. It does so in two steps:<ol>
<li>
First, the URI is <em>transformed</em> to a <em>relative path</em> via the algorithm listed below.</li>
<li>
Second, Zorba attempts to load the relative path within every directory listed on its <em>URI path</em>. (Through this documentation, a "path" is defines as "an ordered list of directories in the filesystem.)</li>
</ol>
<div id="mangling" class="sect2"><h3>URI Transformation</h3>
Consider a library module with the namespace <a href="http://www.example.com/modules/utils" target="_blank">http://www.example.com/modules/utils</a>. This namespace URI will be rewritten by the following steps:<ol>
<li>
The domain (authority) component of the URI is reversed, and then transformed into a relative filename separated by forward slashes: <tt>www.example.com</tt> =&gt; <tt>com/example/www</tt></li>
<li>
The path component of the URI is appended: <tt>/modules/utils</tt></li>
<li>
If the path component ends with a trailing slash, the word "index" will be appended</li>
<li>
Finally, an appropriate filename extension will be added if it is not already present. For modules, the suffix is <tt>.xq</tt>, and for schemas, the suffix is <tt>.xsd</tt>.</li>
</ol>
So, the final relative path in our example would be <tt>com/example/www/modules/utils.xq</tt>. A couple more examples (all are presumed to be module URIs):<ul>
<li>
 =&gt; <tt>com/example/www/modules/utils/index.xq</tt></li>
<li>
 =&gt; <tt>com/example/www/modules/mylib.xq</tt></li>
</ul>
</div>
<div id="uripath" class="sect2"><h3>Zorba's URI Path</h3>
Zorba will now attempt to find the named file relative to each directory in the <em>URI Path</em>. By default, the only entry on the URI path is the directory <tt>/usr/share/zorba/uris/</tt> (on Unix and MacOS X) or <tt>C:\Program Files\Zorba 2.1.0\share\zorba\uris</tt> (on Windows). So, to complete this example, assuming Zorba is installed on a Unix system in the default location, Zorba will attempt to resolve the module namespace URI  to the file<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/usr/share/zorba/modules/com/example/www/modules/utils.xq</span>
</pre>If you have modules or schemas installed in other locations on your system, you may provide additional search directories either by passing the <tt>--uri-path</tt> command-line argument to Zorba, or by setting the <tt>ZORBA_URI_PATH</tt> environment variable. In both cases, the value is an ordered list of filesystem directories separated by ":" (on Unix/MacOS X) or ";" (on Windows). Zorba will search each directory on the URI path in the order specified, and the first match found will be used. So, for example, if you invoke Zorba as follows (example is for a Unix system):<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>zorba<span>&nbsp;</span>--uri-path<span>&nbsp;</span></span><span class="stringliteral">'/home/foo/xquery/uris:/opt/share/xquery/uris'</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>-q<span>&nbsp;</span></span><span class="stringliteral">'import<span>&nbsp;</span>module<span>&nbsp;</span>namespace<span>&nbsp;</span>utils="http://www.example.com/modules/utils";<span>&nbsp;</span>1'</span>
</span></pre>Zorba will attempt to load the module from the following locations, in order:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/home/foo/xquery/uris/com/example/www/modules/utils.xq</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/opt/share/xquery/uris/com/example/www/modules/utils.xq</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/usr/share/zorba/uris/com/example/www/modules/utils.xq</span>
</pre>If, after searching all URI path directories, no match is found for a given URI, Zorba will by default fall back to interpretting the URI as a URL and loading the resource via HTTP / HTTPS / FTP (depending on the URI scheme). This behaviour can be defeated by disabling the <tt>http-uri-resolution</tt> Zorba option (see <a href="/pages/3.0/zorba/options_and_annotations?anchor=options_features">Enabling or Disabling Features</a>).</div>
</div>
<div id="libpath" class="sect1"><h2>Zorba's Library Path</h2>
The above URI path mechanism is used for all URIs that are resolved by Zorba - most especially module and schema imports, but also full-text thesaurus and stop-word lists, documents, and so on.When considering modules in particular, however, there is another important path: the Library Path. Zorba will look on this path when it needs to load dynamic libraries containing the implementation of external functions for a module (ie, those functions implemented in C++; see <a href="/pages/3.0/zorba/modules_authoring_2?anchor=mod_author_cpp">External Functions in C++</a>). This path is separate from the URI path because on certain systems - most notably Fedora, but also other Linux distributions - it is important that platform-dependent binary files (such as dynamic libraries) be installed in a separate directory structure from platform-independent files (such as <tt>.xq</tt> module files and <tt>.xsd</tt> schema files).The Library Path mechanism is exactly parallel to the URI Path mechanism. The default, built-in entry on this path is <tt>/usr/lib/zorba</tt> (on Unix and MacOS X) and <tt>C:\Program Files\Zorba 2.1.0\lib\zorba</tt> (on Windows). You can add directories to this path using the <tt>--lib-path</tt> command-line argument, or by setting the <tt>ZORBA_LIB_PATH</tt> environment variable.</div>
<div id="internalpaths" class="sect1"><h2>Internal (Core) Paths</h2>
There is actually one additional built-in directory on Zorba's URI Path, and one additional built-in directory on Zorba's Library Path, in addition to the default values mentioned above. These directories hold Zorba's built-in "core" modules (see <a href="/pages/3.0/zorba/modules_top?anchor=core_modules">Core Modules</a>). The directories are subdirectories of the default directory named "core/ZORBA_VERSION". So for example, for Zorba 2.1.0 on Unix, the default internal URI directory is <tt>/usr/share/zorba/uris/core/2.1.0</tt> and the default internal library directory is <tt>/usr/lib/zorba/core/2.1.0</tt>.These directories are separate to make it easier to upgrade Zorba, or support multiple installed versions of Zorba, while allowing non-core modules to be installed and versioned indepedently of the Zorba version. Normally you should not modify the contents of these directories.</div>
<div id="configurepaths" class="sect1"><h2>Changing the Default Paths</h2>
All four paths mentioned above - the core and non-core URI Path, and the core and non-core Library Path - have compiled-in default values as discussed. All four of these default values can be modified at Zorba build time to meet your environment's requirements. You can do this by specifying alternate values for the following CMake variables:<pre class="ace-static" ace-mode="xquery"><span class="normal">ZORBA_NONCORE_URI_DIR</span>
<span class="normal">ZORBA_CORE_URI_DIR</span>
<span class="normal">ZORBA_NONCORE_LIB_DIR</span>
<span class="normal">ZORBA_CORE_LIB_DIR</span>
</pre>Note that these are <em>relative</em> directories, and will be resolved relative to <tt>CMAKE_INSTALL_PREFIX</tt>.</div>
<div id="modulepath" class="sect1"><h2>Zorba's "Module Path"</h2>
Earlier versions of Zorba had a single path for specifying where both platform-dependent library files and platform-independent module and schema files were located. This was somewhat inaccurately named the "module path". For backwards compatibility, Zorba still supports a <tt>--module-path</tt> command-line argument and a <tt>ZORBA_MODULE_PATH</tt> environment variable (and the C++ API has a <tt>StaticContext::setModulePaths()</tt> method). Specifying a set of directories as the "module path" using any of these mechanisms is exactly the same as specifying that set of directories as both the URI path and library path.The Module Path is deprecated, and these mechanisms may be removed in a future major version of Zorba. There is no "default module path".</div>
<div id="cplusplus" class="sect1"><h2>C++ API for URI Resolving</h2>
<div id="cppuripath" class="sect2"><h3>Modifying the URI Path programmatically</h3>
The simplest modification to Zorba's default behavior is setting the URI path programmatically. This allows you to have different URI paths per static context, if you wish.The <tt>StaticContext</tt> C++ API class provides the <tt>setURIPath()</tt> method for this purpose. It is passed a vector of  values, each being an absolute directory to add to the URI path.For example, the following code snippet creates a <tt>StaticContext</tt> object; adds two directories to the URI path component of this static context; and compiles and executes a query given the information that is present in this static context (passed as the second parameter to the <tt>compileQuery()</tt> method).<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="comment">//<span>&nbsp;</span>Create<span>&nbsp;</span>a<span>&nbsp;</span>new<span>&nbsp;</span>static<span>&nbsp;</span>context</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1SmartPtr">zorba::StaticContext_t</a><span>&nbsp;</span>staticCtx<span>&nbsp;</span>=<span>&nbsp;</span>zorba-&gt;createStaticContext();</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="comment">//<span>&nbsp;</span>Set<span>&nbsp;</span>the<span>&nbsp;</span>URI<span>&nbsp;</span>Path</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>std::vector&lt;zorba::String&gt;<span>&nbsp;</span>uriPath(2);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>uriPath[0]<span>&nbsp;</span>=<span>&nbsp;</span></span><span class="stringliteral">"/home/foo/xquery/uris"</span><span class="normal">;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>uriPath[1]<span>&nbsp;</span>=<span>&nbsp;</span></span><span class="stringliteral">"/opt/share/xquery/uris"</span><span class="normal">;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>staticCtx-&gt;setURIPath(uriPath);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="comment">//<span>&nbsp;</span>Compile<span>&nbsp;</span>a<span>&nbsp;</span>query<span>&nbsp;</span>using<span>&nbsp;</span>the<span>&nbsp;</span>static<span>&nbsp;</span>context<span>&nbsp;</span>created<span>&nbsp;</span>above</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1SmartPtr">zorba::XQuery_t</a><span>&nbsp;</span>query<span>&nbsp;</span>=<span>&nbsp;</span>zorba-&gt;compileQuery(</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="stringliteral">"import<span>&nbsp;</span>module<span>&nbsp;</span>namespace<span>&nbsp;</span>m='http://example.com/module';<span>&nbsp;</span>m:foo()"</span><span class="normal">,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>staticCtx);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="comment">//<span>&nbsp;</span>execute<span>&nbsp;</span>the<span>&nbsp;</span>compiled<span>&nbsp;</span>query<span>&nbsp;</span>printing<span>&nbsp;</span>the<span>&nbsp;</span>result<span>&nbsp;</span>to<span>&nbsp;</span>standard<span>&nbsp;</span>out</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>std::cout<span>&nbsp;</span>&lt;&lt;<span>&nbsp;</span>query<span>&nbsp;</span>&lt;&lt;<span>&nbsp;</span>std::endl;</span>
</span></span></span></span></pre></div>
<div id="cpplibpath" class="sect2"><h3>Modifying the Library Path programmatically</h3>
Similarly, <tt>StaticContext</tt> has a method named <tt>setLibPath()</tt> for specifying the Library Path to use. In operation it behaves exactly like <tt>setURIPath()</tt>.</div>
<div id="mapresolve" class="sect2"><h3>URI Mappers and URL Resolvers</h3>
Now we will discuss more advanced techniques for manipulating Zorba's URI resolution mechanism. The built-in mechanisms described above are in fact implemented internally by using these same techniques.There are two types of class that you may implement to modify the URI resolution process:<ol>
<li>
A <em>URI Mapper</em> takes a URI and returns <em>one or more</em> "Candidate URIs", which are alternative URIs Zorba will attempt to resolve. This allows you to change the URI, or provide several different potential URIs, for Zorba to resolve.</li>
<li>
A <em>URL Resolver</em> takes a URI (which is presumed to be a URL, that is, a URI which actually points to a resource) and returns a <tt>Resource</tt> object which Zorba will use to load the resource data.</li>
</ol>
The general algorithm used by Zorba when resolving a URI is as follows:Zorba will start by passing the original URI to the first registered URI Mapper. If that Mapper returns any candidate URIs, then Zorba will pass <em>each</em> such URI to the next registered URI Mapper, and so on. If any Mapper does not return any candidate URIs for a given input URI, Zorba will simply pass the input URI unchanged to the next Mapper.After all Mappers have been invoked, Zorba will have a set of candidate URIs. It will then pass each candidate URI, in order, to each registered URL Resolver. The first time a URL Resolver returns a Resource object, Zorba will use that Resource as the final source of content for the URI. If no URL Resolver ever returns a Resource, then Zorba will raise an appropriate "resource not found" error.<div id="uriresolvers_1urimappers" class="sect3"><h4>URI Mappers</h4>
Zorba includes a few built-in URI Mappers. For instance, the mechanism which iterates through the URI path and produces a set of filesystem files where the URI might be located is implemented as a URI Mapper.To implement your own URI Mapper, subclass the C++ API class <tt>URIMapper</tt> and implement the <tt>mapURI()</tt> method:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span></span><span class="keywordtype">void</span><span class="normal"><span>&nbsp;</span>mapURI(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">zorba::String</a><span>&nbsp;</span>aUri,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>EntityData<span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData,<span>&nbsp;</span>std::vector&lt;zorba::String&gt;&amp;<span>&nbsp;</span>oUris);</span>
</pre>and then register an instance of your subclass with the static context using the method <tt>registerURIMapper()</tt>:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><a href="/pages/3.0/zorba/namespacezorba?anchor=a24d7241f6bf20badc1017264d30b2af5">StaticContext_t</a><span>&nbsp;</span>lContext<span>&nbsp;</span>=<span>&nbsp;</span>aZorba-&gt;<a href="/pages/3.0/zorba/classzorba_1_1Zorba?anchor=a9c2f950f6c68a948683ae15d587d756c">createStaticContext</a>();</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>MyURIMapperSubclass*<span>&nbsp;</span>lMapper<span>&nbsp;</span>=<span>&nbsp;</span></span><span class="keyword">new</span><span class="normal"><span>&nbsp;</span>MyURIMapperSubclass();</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>lContext-&gt;registerURIMapper(lMapper);</span>
</pre>Note that the memory ownership of the <tt>URIMapper</tt> instance remains with the client program; it must de-allocate it appropriately when the static context is no longer used.In your <tt>mapURI()</tt> implementation, <tt>aUri</tt> is the input URI. <tt>aEntityData</tt> is a pointer to additional information about the URI being resolved. As of Zorba 2.0, the only method on <tt>EntityData</tt> is <tt>getKind()</tt>, which will return an enumerated value describing what kind of URI is being resolved: SCHEMA, MODULE, THESAURUS, STOP_WORDS, COLLECTION, or DOCUMENT.<tt>oUris</tt> is where you place any candidate URIs, by calling the method <tt>push_back()</tt>. (You should not look at any existing contents of the vector.) If you push any candidate URIs onto the vector, Zorba will <em>replace</em> the input URI with the set of candidate URIs you provide. That means that if you want Zorba to consider the original URI <em>in addition to</em> the alternative URIs you provide, you must push the original URI onto the vector as well.The <tt>mapURI()</tt> method should not throw any exceptions.As a limited but functional example, here is a full class which will change the URI of a specific schema to an alternative URI. You could use this, for example, if you have a large body of XQueries using a particular schema that you do want Zorba to download from the web (hence the built-in filesystem mapping mechanism is not appropriate), but the URI that the schema is available from has changed and you do not wish to modify all the <tt>import schema</tt> statements.<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">class<span>&nbsp;</span></span><span class="normal">MySchemaURIMapper<span>&nbsp;</span>:<span>&nbsp;</span></span><span class="keyword">public</span><span class="normal"><span>&nbsp;</span>URIMapper</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">public</span><span class="normal">:</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>~MySchemaURIMapper()<span>&nbsp;</span>{}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span></span><span class="keywordtype">void</span><span class="normal"><span>&nbsp;</span>mapURI(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">zorba::String</a><span>&nbsp;</span>aUri,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>EntityData<span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>std::vector&lt;zorba::String&gt;&amp;<span>&nbsp;</span>oUris)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal"><span>&nbsp;</span>(aEntityData-&gt;getKind()<span>&nbsp;</span>!=<span>&nbsp;</span>EntityData::SCHEMA)<span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">return</span><span class="normal">;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal">(aUri<span>&nbsp;</span>==<span>&nbsp;</span></span><span class="stringliteral">"http://www.example.com/helloworld"</span><span class="normal">)<span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>oUris.push_back(</span><span class="stringliteral">"http://example.com/schemas/helloworld.xsd"</span><span class="normal">);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>};</span>
</pre>Note that the first thing <tt>mapURI()</tt> does is check that the URI being resolved is in fact for a schema. This is generally good practice to prevent surprises in the off-chance that the same URI is also used to identify some other kind of resource.</div>
<div id="uriresolvers_1urlresolvers" class="sect3"><h4>URL Resolvers</h4>
Zorba includes two built-in URL Resolvers: One which handles <tt>file:</tt> URLs, and one which handles <tt>http:</tt>, <tt>https:</tt>, and <tt>ftp:</tt> URLs. These are implemented by using Zorba's <tt>file</tt> and <tt>http-client</tt> modules, respectively.To implement your own URL Resolver, subclass the C++ API class <tt>URLResolver</tt> and implement the <tt>resolveURL()</tt> method:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>Resource*<span>&nbsp;</span>resolveURL(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">zorba::String</a>&amp;<span>&nbsp;</span>aUrl,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>EntityData<span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData);</span>
</pre>and then register an instance of your subclass with the static context using the method <tt>registerURLResolver()</tt>:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><a href="/pages/3.0/zorba/namespacezorba?anchor=a24d7241f6bf20badc1017264d30b2af5">StaticContext_t</a><span>&nbsp;</span>lContext<span>&nbsp;</span>=<span>&nbsp;</span>aZorba-&gt;<a href="/pages/3.0/zorba/classzorba_1_1Zorba?anchor=a9c2f950f6c68a948683ae15d587d756c">createStaticContext</a>();</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>MyURLResolverSubclass*<span>&nbsp;</span>lResolver<span>&nbsp;</span>=<span>&nbsp;</span></span><span class="keyword">new</span><span class="normal"><span>&nbsp;</span>MyURLResolverSubclass();</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>lContext-&gt;registerURLResolver(lResolver);</span>
</pre>You will note that this mechanism is exactly parallel to the URI Mapper mechanism. Also, as with URI Mappers, the memory ownership of the <tt>URLResolver</tt> instance remains with the client program; it must de-allocate it appropriately when the static context is no longer used.In your <tt>resolveURL()</tt> method, the <tt>aUri</tt> and <tt>aEntityData</tt> arguments have exactly the same meanings as they do for <tt>mapURI()</tt>.If your code recognizes the URL and wishes to return content for it, it must return a newly-allocated instance of some subclass of the abstract class <tt>Resource</tt>. In Zorba 2.0's public API, there is only one such subclass, <tt>StreamResource</tt>, which wraps around a <tt>std::istream</tt>.It is important that all URL Resolvers check the <tt>EntityData</tt>'s Kind and only return Resources for the appropriate kind of URIs, for two reasons:<ol>
<li>
They must return an appropriate subclass of <tt>Resource</tt> depending on the entity kind. Zorba is prepared to accept <tt>StreamResource</tt> for schemas, modules, stop-word lists, thesauri, and documents, but not for collections. In future, there will likely be additional resource subclasses and additional entity kinds, and returning an inappropriate resource subclass for a given entity type will have negative consequences.</li>
<li>
They must return a resource which produces data appropriate for the kind of entity being resolved. For instance, when resolving a schema or document URI, Zorba expects the resource to produce well-formed XML. When resolving a module URI, Zorba expects the resource to produce an XQuery library module. Returning a resource which outputs incorrect data will result in errors.</li>
</ol>
As a fairly silly but functional example, here is a URL Resolver that returns a small hard-coded module for a specific URL:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">using<span>&nbsp;</span>namespace<span>&nbsp;</span></span><span class="normal">zorba;</span>
<span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">static</span><span class="normal"><span>&nbsp;</span></span><span class="keywordtype">void</span><span class="normal"><span>&nbsp;</span>streamReleaser(std::istream*<span>&nbsp;</span>aStream)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">delete</span><span class="normal"><span>&nbsp;</span>aStream;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">class<span>&nbsp;</span></span><span class="normal">FoobarModuleURLResolver<span>&nbsp;</span>:<span>&nbsp;</span></span><span class="keyword">public</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1URLResolver">URLResolver</a></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">public</span><span class="normal">:</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>~FoobarModuleURLResolver()<span>&nbsp;</span>{}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1Resource">Resource</a>*<span>&nbsp;</span>resolveURL(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">String</a>&amp;<span>&nbsp;</span>aUrl,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1EntityData">EntityData</a><span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="comment">//<span>&nbsp;</span>we<span>&nbsp;</span>have<span>&nbsp;</span>only<span>&nbsp;</span>one<span>&nbsp;</span>module</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal"><span>&nbsp;</span>(aEntityData-&gt;<a href="/pages/3.0/zorba/classzorba_1_1EntityData?anchor=a28e3e16623b5d77a68d1849d6a22533b">getKind</a>()<span>&nbsp;</span>==<span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1EntityData?anchor=a12bf89226b6bd93b9bf5f56343c0c18aa5b5cce2ccde7d14ae032911e86e5c4d2">EntityData::MODULE</a><span>&nbsp;</span>&amp;&amp;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>aUrl<span>&nbsp;</span>==<span>&nbsp;</span></span><span class="stringliteral">"http://www.example.com/foobar"</span><span class="normal">)<span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">return</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1StreamResource?anchor=aec38e33bd9b3f68aae28bc15c01af83e">StreamResource::create</a></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>(</span><span class="keyword">new</span><span class="normal"><span>&nbsp;</span>std::istringstream</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>(</span><span class="stringliteral">"module<span>&nbsp;</span>namespace<span>&nbsp;</span>lm<span>&nbsp;</span>=<span>&nbsp;</span>'http://www.example.com/foobar';<span>&nbsp;</span>"</span><span class="normal">
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="stringliteral">"declare<span>&nbsp;</span>function<span>&nbsp;</span>lm:foo()<span>&nbsp;</span>{<span>&nbsp;</span>'foo'<span>&nbsp;</span>};"</span><span class="normal">),<span>&nbsp;</span>&amp;streamReleaser);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">else</span><span class="normal"><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">return</span><span class="normal"><span>&nbsp;</span>NULL;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>};</span>
</span></span></span></span></pre>A more realistic example would be a resolver that takes URLs (possibly with a non-standard scheme, such as <tt>db:</tt>) and loads the content for those URLs from a database. As long as the database API allows you to obtain the information as a <tt>std::istream</tt>, you may stream this data directly to Zorba.Two notes about memory management: First, when a user-defined <tt>URLResolver</tt> returns a <tt>Resource</tt>, Zorba will take memory ownership of the <tt>Resource</tt>, and will free it when it is no longer needed. Second, when user code creates a <tt>StreamResource</tt>, the <tt>StreamResource</tt> assumes memory ownership of the <tt>std::istream</tt> that is wrapped. However, Zorba cannot free the <tt>std::istream</tt> itself, because it was instantiated inside user code rather than inside Zorba's own library. On Windows, in some circumstances, if a DLL deletes an object that was not instantiated inside that DLL, the application will crash. Therefore, the <tt>StreamResource</tt> factory function <tt>create()</tt> also takes a <tt>StreamReleaser</tt>, which is a function pointer. Zorba will call this function pointer, passing the <tt>std::istream</tt>, when it is no longer needed; the function is expected to free the <tt>std::istream</tt>.Unlike <tt>mapURI()</tt>, it is acceptable for <tt>resolveURL</tt> to throw exceptions. A URL Resolver should throw an exception if it believes that it is canonical for the URL (that is, it "should be able" to resolve it) but had some error during the attempt to resolve it. However, because Zorba may be attempting to resolve a number of candidate URIs, any exceptions thrown from a URL Resolver will be caught and consumed by Zorba. It will never re-throw any of these exceptions. It will merely remember the message of the first exception (assuming that it extends <tt>std::exception</tt>). If and only if <em>no</em> URL Resolver ever returns a valid Resource, Zorba will then throw a new exception with the saved message from the first-thrown exception.</div>
</div>
<div id="component" class="sect2"><h3>Component URI Mappers for modules</h3>
In XQuery, it is possible for a particular module to actually be implemented as a set of more than one <tt>.xq</tt> files. When a query imports the module's URI, the query processor is expected to provide some mechanism whereby multiple files will be loaded and combined to form the whole module definition.Zorba uses <em>Component URI Mappers</em> to allow for this. The API is the same <tt>URIMapper</tt> class, and they are registered with the static context using the same <tt>registerURIMapper()</tt> method.How does Zorba know which URI Mappers are intended to provide a set of URIs for the components of a module, and which are intended to provide a set of <em>possible</em> candidate URIs for other purposes? There is actually another method on the <tt>URIMapper</tt> class: <tt>mapperKind()</tt>. This method should return a value from the enumeration <tt>URIMapper::Kind</tt>. There are two possible values: COMPONENT and CANDIDATE. The default implementation of <tt>URIMapper</tt> returns CANDIDATE, so for normal URI Mappers there is no need to override this method.When Zorba needs to resolve a URI for a module import, it first invokes all registered component URI mappers to form a set of <em>component URIs</em>. Then, it resolves <em>each</em> of these component URIs using the full URI resoltuion mechanism documented above - calling all candidate URI mappers and URL resolvers in turn. Assuming that it successfully loads a Resource for <em>each</em> component URI, it then assembles all of these Resources into the final, loaded module.Here is an example of a component URI mapper, which tells Zorba to load two other URIs to form a complete module:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">class<span>&nbsp;</span></span><span class="normal">MyModuleURIMapper<span>&nbsp;</span>:<span>&nbsp;</span></span><span class="keyword">public</span><span class="normal"><span>&nbsp;</span>URIMapper</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">public</span><span class="normal">:</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>~MyModuleURIMapper()<span>&nbsp;</span>{}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>URIMapper::Kind<span>&nbsp;</span>mapperKind()<span>&nbsp;</span>throw()<span>&nbsp;</span>{<span>&nbsp;</span></span><span class="keywordflow">return</span><span class="normal"><span>&nbsp;</span>URIMapper::COMPONENT;<span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span></span><span class="keywordtype">void</span><span class="normal"><span>&nbsp;</span>mapURI(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">zorba::String</a><span>&nbsp;</span>aUri,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>EntityData<span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>std::vector&lt;zorba::String&gt;&amp;<span>&nbsp;</span>oUris)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal"><span>&nbsp;</span>(aEntityData-&gt;getKind()<span>&nbsp;</span>!=<span>&nbsp;</span>EntityData::MODULE)<span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">return</span><span class="normal">;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal">(aUri<span>&nbsp;</span>==<span>&nbsp;</span></span><span class="stringliteral">"http://www.example.com/mymodule"</span><span class="normal">)<span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>oUris.push_back(</span><span class="stringliteral">"http://www.example.com/mymodule/mod1"</span><span class="normal">);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>oUris.push_back(</span><span class="stringliteral">"http://www.example.com/mymodule/mod2"</span><span class="normal">);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>};</span>
</pre>As mentioned, each of the component URIs will be treated to the full URI resolution mechanism, including Zorba's built-in mechanisms. So, given the code above and a default Unix installation, Zorba will proceed to attempt to load the following files:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/usr/share/zorba-2.0.0/modules/com/example/www/mymodule/mod1.xq</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>/usr/share/zorba-2.0.0/modules/com/example/www/mymodule/mod2.xq</span>
</pre>If both are found, then the two together will be taken to form the complete definition for the module .</div>
<div id="disallowing" class="sect2"><h3>Disallowing URIs</h3>
Sometimes, it might be required to forbid access to a certain URI. For example, a user might disallow access to the file module because she doesnt want XQuery developers to access files stored locally on the machine that is running Zorba. (Remember that the built-in URL Resolver for <tt>file:</tt> URLs is implemented in terms of the file module, so doing this will effectively disable all file access - module and schema importing, loading documents, and so on.)Therefore, the static context also provides a mechanism for preventing developers from importing particular modules. This is also handled with a <tt>URIMapper</tt> in a simple way: If <em>any</em> registered URI Mapper (candidate or component) ever returns the value <tt>URIMapper::DENY_ACCESS</tt> in the <tt>oUris</tt> vector, Zorba will immediately throw a "URI access denied" exception.Here is an example URI Mapper which will suppress the loading of the file module:<pre class="ace-static" ace-mode="xquery"><span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">class<span>&nbsp;</span></span><span class="normal">DenyFileAccessURIMapper<span>&nbsp;</span>:<span>&nbsp;</span></span><span class="keyword">public</span><span class="normal"><span>&nbsp;</span>URIMapper</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">public</span><span class="normal">:</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span>~DenyFileAccessURIMapper()<span>&nbsp;</span>{}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keyword">virtual</span><span class="normal"><span>&nbsp;</span></span><span class="keywordtype">void</span><span class="normal"><span>&nbsp;</span>mapURI(</span><span class="keyword">const</span><span class="normal"><span>&nbsp;</span><a href="/pages/3.0/zorba/classzorba_1_1String">zorba::String</a><span>&nbsp;</span>aUri,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>EntityData<span>&nbsp;</span></span><span class="keyword">const</span><span class="normal">*<span>&nbsp;</span>aEntityData,</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>std::vector&lt;zorba::String&gt;&amp;<span>&nbsp;</span>oUris)</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></span><span class="keywordflow">if</span><span class="normal">(aEntityData-&gt;getKind()<span>&nbsp;</span>==<span>&nbsp;</span>EntityData::MODULE<span>&nbsp;</span>&amp;&amp;</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>aUri<span>&nbsp;</span>==<span>&nbsp;</span></span><span class="stringliteral">"http://www.zorba-xquery.com/modules/file"</span><span class="normal">)<span>&nbsp;</span>{</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>oUris.push_back(URIMapper::DENY_ACCESS);</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>}</span>
<span class="normal"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>};</span>
</pre> </div>
</div>
    </div>
</div></div>
                <div id="disqus" class="disqus" disqus="">
                    <div id="disqus_thread" class="content-panel-content"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" tabindex="0" title="Disqus" style="width: 100% !important; border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial !important; border-color: initial !important; overflow-x: hidden !important; overflow-y: hidden !important; height: 928px !important; " width="100%" src="http://disqus.com/embed/comments/?disqus_version=1df9d712&amp;base=default&amp;f=28msec&amp;t_i=%2Fdocumentation%2F3.0%2Fzorba%2Farchitecture%2Furiresolvers%2F&amp;t_u=http%3A%2F%2Fwww.28.io%2Fdocumentation%2F3.0%2Fzorba%2Farchitecture%2Furiresolvers%2F&amp;t_d=Zorba%20-%20The%20NoSQL%20Query%20Processor&amp;t_t=Zorba%20-%20The%20NoSQL%20Query%20Processor&amp;s_o=default#2" scrolling="no" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
                </div>
            </div>
            <!-- ngSwitchWhen: api -->
            <!-- ngSwitchWhen: modules -->
            <!-- ngSwitchWhen: notfound -->
            <!-- ngSwitchDefault:  -->
        </div>
    </div>
</div></div>
        <footer id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-sm-4">
                        <h3>Get Involved</h3>
                        <ul>
                            <li><a href="https://groups.google.com/forum/#!forum/zorba-users" target="_blank">Users List on Google Groups</a></li>
                            <li><a href="https://groups.google.com/forum/#!forum/zorba-dev" target="_blank">Developers List on Google Groups</a></li>
                            <li><a href="https://bugs.launchpad.net/zorba/+bugs" target="_blank">Bug Tracker</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-4">
                        <h3>Resources</h3>
                        <li><a href="http://jsoniq.org" target="_blank">JSONiq</a></li>
                        <li><a href="http://www.w3.org/TR/xquery-30/" target="_blank">XQuery 3.0</a></li>
                    </div>
                    <div class="col-sm-4">
                        <h3>Quick Links</h3>
                        <li><a href="https://code.launchpad.net/zorba" target="_blank">Source Code</a></li>
                        <li><a href="/download">Download</a></li>
                        <li><a href="/blog">Blog</a></li>
                    </div>
                </div>
                <p class="text-center copyright">
                    <small>
                    &nbsp;2013 Zorba.
                    </small>
                </p>
            </div>        
        </footer>
    <script type="text/javascript" async="" src="http://stats.g.doubleclick.net/dc.js"></script><script charset="ISO-8859-1" src="http://fast.wistia.com/static/concat/E-v1.js"></script>
    <script src="/scripts/scripts.js"></script>
    <script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-4281090-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; 
ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
        </script>
  
<script type="text/javascript" async="" src="http://28msec.disqus.com/embed.js"></script></body></html><script type="text/javascript">location.href = '/#' + location.pathname;</script>